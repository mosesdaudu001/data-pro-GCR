{% extends "base.html" %}

{% block title %}Reporting - CBL GRC Platform{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2><i class="fas fa-chart-bar"></i> Automated Reporting</h2>
                <p class="text-muted">Generate regulatory reports, risk assessments, and compliance summaries</p>
            </div>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#generateReportModal">
                <i class="fas fa-plus"></i> Generate New Report
            </button>
        </div>
    </div>
</div>

<!-- Report Categories -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-university fa-3x text-primary mb-3"></i>
                <h5>Regulatory Reports</h5>
                <p class="text-muted">Basel III, AML/CFT, IFRS compliance</p>
                <button class="btn btn-primary btn-sm">Generate</button>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                <h5>Risk Reports</h5>
                <p class="text-muted">Risk assessments and analysis</p>
                <button class="btn btn-warning btn-sm">Generate</button>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                <h5>Compliance Reports</h5>
                <p class="text-muted">Compliance status and tracking</p>
                <button class="btn btn-success btn-sm">Generate</button>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-search fa-3x text-info mb-3"></i>
                <h5>Audit Reports</h5>
                <p class="text-muted">Internal audit findings</p>
                <button class="btn btn-info btn-sm">Generate</button>
            </div>
        </div>
    </div>
</div>

<!-- Recent Reports -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h5><i class="fas fa-file-alt"></i> Recent Reports</h5>
                    <div class="btn-group btn-group-sm" role="group">
                        <input type="radio" class="btn-check" name="reportFilter" id="all" autocomplete="off" checked>
                        <label class="btn btn-outline-primary" for="all">All</label>
                        
                        <input type="radio" class="btn-check" name="reportFilter" id="regulatory" autocomplete="off">
                        <label class="btn btn-outline-primary" for="regulatory">Regulatory</label>
                        
                        <input type="radio" class="btn-check" name="reportFilter" id="risk" autocomplete="off">
                        <label class="btn btn-outline-primary" for="risk">Risk</label>
                        
                        <input type="radio" class="btn-check" name="reportFilter" id="compliance" autocomplete="off">
                        <label class="btn btn-outline-primary" for="compliance">Compliance</label>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Report Name</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Generated Date</th>
                                <th>Generated By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for report in reports %}
                            <tr>
                                <td>
                                    <i class="fas fa-file-{% if report.type == 'Regulatory' %}university{% elif report.type == 'Risk' %}exclamation-triangle{% elif report.type == 'Compliance' %}check-circle{% else %}chart-bar{% endif %} me-2"></i>
                                    {{ report.name }}
                                </td>
                                <td>
                                    <span class="badge bg-{% if report.type == 'Regulatory' %}primary{% elif report.type == 'Risk' %}warning{% elif report.type == 'Compliance' %}success{% else %}info{% endif %}">
                                        {{ report.type }}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge bg-{% if report.status == 'Generated' %}success{% elif report.status == 'In Progress' %}warning{% else %}secondary{% endif %}">
                                        {{ report.status }}
                                    </span>
                                </td>
                                <td>{{ report.date }}</td>
                                <td>{{ current_user.username }}</td>
                                <td>
                                    {% if report.status == 'Generated' %}
                                    <button class="btn btn-sm btn-primary" onclick="downloadReport('{{ report.name }}')">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                    <button class="btn btn-sm btn-info" onclick="viewReport('{{ report.name }}')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="shareReport('{{ report.name }}')">
                                        <i class="fas fa-share"></i> Share
                                    </button>
                                    {% elif report.status == 'In Progress' %}
                                    <button class="btn btn-sm btn-warning" disabled>
                                        <i class="fas fa-spinner fa-spin"></i> Generating...
                                    </button>
                                    {% else %}
                                    <button class="btn btn-sm btn-primary" onclick="generateReport('{{ report.name }}')">
                                        <i class="fas fa-play"></i> Generate
                                    </button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scheduled Reports -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-calendar-alt"></i> Scheduled Reports</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Report Name</th>
                                <th>Frequency</th>
                                <th>Next Run</th>
                                <th>Recipients</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Basel III Capital Adequacy Report</td>
                                <td>Monthly</td>
                                <td>2024-11-01</td>
                                <td>Board of Directors, Risk Committee</td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td>
                                    <button class="btn btn-sm btn-warning" onclick="editSchedule(1)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="pauseSchedule(1)">
                                        <i class="fas fa-pause"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Risk Assessment Summary</td>
                                <td>Weekly</td>
                                <td>2024-10-21</td>
                                <td>Risk Manager, CEO</td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td>
                                    <button class="btn btn-sm btn-warning" onclick="editSchedule(2)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="pauseSchedule(2)">
                                        <i class="fas fa-pause"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>AML Transaction Monitoring Report</td>
                                <td>Daily</td>
                                <td>2024-10-16</td>
                                <td>AML Officer, Compliance Team</td>
                                <td><span class="badge bg-warning">Paused</span></td>
                                <td>
                                    <button class="btn btn-sm btn-success" onclick="resumeSchedule(3)">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="editSchedule(3)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Generate Report Modal -->
<div class="modal fade" id="generateReportModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-file-alt"></i> Generate New Report</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Report Type</label>
                            <select class="form-select" id="reportType">
                                <option value="regulatory">Regulatory Report</option>
                                <option value="risk">Risk Assessment Report</option>
                                <option value="compliance">Compliance Status Report</option>
                                <option value="audit">Internal Audit Report</option>
                                <option value="custom">Custom Report</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Report Template</label>
                            <select class="form-select" id="reportTemplate">
                                <option value="basel3">Basel III Capital Report</option>
                                <option value="aml">AML/CFT Compliance Report</option>
                                <option value="ifrs9">IFRS 9 ECL Report</option>
                                <option value="risk_summary">Risk Summary Report</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date Range From</label>
                            <input type="date" class="form-control" id="dateFrom" value="2024-09-01">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date Range To</label>
                            <input type="date" class="form-control" id="dateTo" value="2024-10-15">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Output Format</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="formatPDF" checked>
                            <label class="form-check-label" for="formatPDF">PDF</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="formatExcel">
                            <label class="form-check-label" for="formatExcel">Excel</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="formatWord">
                            <label class="form-check-label" for="formatWord">Word</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Recipients (Optional)</label>
                        <input type="email" class="form-control" placeholder="Enter email addresses separated by commas">
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="scheduleReport">
                            <label class="form-check-label" for="scheduleReport">
                                Schedule this report for regular generation
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="startReportGeneration()">
                    <i class="fas fa-cog"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function downloadReport(reportName) {
    alert('Download functionality would be implemented here for: ' + reportName);
}

function viewReport(reportName) {
    alert('View report functionality would be implemented here for: ' + reportName);
}

function shareReport(reportName) {
    alert('Share report functionality would be implemented here for: ' + reportName);
}

function generateReport(reportName) {
    alert('Generate report functionality would be implemented here for: ' + reportName);
}

function editSchedule(scheduleId) {
    alert('Edit schedule functionality would be implemented here for Schedule ID: ' + scheduleId);
}

function pauseSchedule(scheduleId) {
    alert('Pause schedule functionality would be implemented here for Schedule ID: ' + scheduleId);
}

function resumeSchedule(scheduleId) {
    alert('Resume schedule functionality would be implemented here for Schedule ID: ' + scheduleId);
}

function startReportGeneration() {
    // Show progress indication
    var modal = document.getElementById('generateReportModal');
    var modalInstance = bootstrap.Modal.getInstance(modal);
    modalInstance.hide();
    
    // Show success message
    alert('Report generation started. You will be notified when complete.');
}
</script>
{% endblock %}